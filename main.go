package main

import (
	"fmt"
	"github.com/hyperdelta/nyduscanal/gateway"
	//"github.com/hyperdelta/nyduscanal/parser"
)

func main() {

	//data := []byte(`
	//{"member_id": "yang4rang","method": "addOrder","short_message": "NOT_SET","type": "ActivityLog","uuid": "b75c51b0-1505-11e7-b889-13fe6b7b1058","http_url": "/order","http_user_agent": "Mozilla/5.0 (Linux; Android 6.0.1; SAMSUNG SM-G600S Build/MMB29M) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/4.0 Chrome/44.0.2403.133 Mobile Safari/537.36","application": "Nova_FE_Mobile","hash_key": "107212a67b22e9e85edb7c10ed4da2ed","payload": "{\"args\":\"[]\",\"query\":{},\"body\":{\"orderData\":{\"OrderIdx\":[\"1113a282a\",\"1113a2829\",\"1113a2827\",\"1113a2825\"],\"CustomsType\":1.0,\"RegNumber\":\"\",\"IsSafeCallUse\":false,\"SelfAuthReqSeq\":\"\",\"agreedCollectingPersonalInfo\":true,\"agreedProvidingPersonalInfo\":true,\"personalInfoTreatAgreement\":false,\"IsDirect\":false,\"IsHappyCardVoucher\":false,\"CartPID\":\"4A32CDAC-B22A-4F74-BA01-49F104CE9AAE\",\"BuyerNo\":\"120425669\",\"LoginId\":\"yang4rang\",\"ClientIP\":\"223.38.8.194\",\"PartnershipCode\":\"200003514\",\"SiteType\":5.0},\"paymentData\":{\"PaymentBase\":{\"PayAuthSeq\":0.0,\"CardCash\":\"\",\"SettleLimitKey\":\"\",\"PaymentName\":\"\",\"AccountType\":2.0,\"AuthPayPrice\":19600.0,\"MediumMethodCode\":\"200000036\",\"SmallMethodCode\":\"300000240\"},\"NewSmilePay\":{\"CertificationId\":\"1000001045029191S001\",\"TotalMoney\":\"19600\",\"SmilePayToken\":\"eyJhbGciOiJBMjU2Q0JDIiwiZW5jIjoiQTI1NkNCQyJ9.~mqYkj21Pz6A8ZNUoGLT79csmPqFy9nVFv3kH1ZCyJJdRt14iAQhKFJVFSqJbGLaNW7HwdUOIAbakh5rnF89IST1yCMeP25e2GO8HozwwggOzOx+J7YoGt4UHd9ueGSNeecbZ8sPob+UUbFADs1BmHOCEjFxcH7F9nUgWT3//9it6bB1a6cO9gqcHP4vh7Te7zN8VVa9DA90DsYwyM+oYibGXrYByKtMQ486iWDeOa6EXDQ7EEh751N6+ehU/maEiLgjhCtdpSuv7M6cNtHmbH2+NP9DDi6GySgNw7wsJa8MeEJYI9CpqOwQ/7Cp7D3vAzntlKmdw0JdE91tZ+o76k0xlb1fteqh2Clq4WceBtAk49pKIptFLlOQctQKjMxOqlK0eP2bf0eLEoEPPELfM3gR5gQSLfjAZOn3QxEFyysHcnaSFfqPqduDl9Q//mekeYhqST1rmFnQpEdeyRwP+omEiA15DQdyTImUh7se1c8g\\u003d\",\"CardRequestMoney\":\"0\",\"CashRequestMoney\":\"19600\",\"MobileRequestMoney\":\"0\",\"EPrepayRequestMoney\":\"0\",\"EtcRequestMoney\":\"0\",\"CashReceiptType\":\"1\",\"CashReceiptWayType\":\"1\",\"CashReceiptEncryptionValue\":\"~OU18/rf7dRWvxYJ8JWzZhw\\u003d\\u003d\",\"SmilePayContractCode\":[{\"buffer\":{\"type\":\"Buffer\",\"data\":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,100.0]},\"offset\":0.0}]}},\"shippingList\":[{\"OrderIdx\":\"1113a282a\",\"Memo\":\"\",\"AddressIdx\":0.0},{\"OrderIdx\":\"1113a2829\",\"Memo\":\"\",\"AddressIdx\":0.0},{\"OrderIdx\":\"1113a2827\",\"Memo\":\"\",\"AddressIdx\":0.0},{\"OrderIdx\":\"1113a2825\",\"Memo\":\"\",\"AddressIdx\":0.0}],\"shippingAddressList\":[{\"AddressIdx\":0.0,\"AddressNo\":\"6aa5a71\",\"IsDefaultAddr\":false,\"DeliveryZipCode1\":\"134\",\"DeliveryZipCode2\":\"770\",\"DeliveryAddr1\":\"서울 강동구 길동 GS강동자이아파트\",\"DeliveryAddr2\":\"110동 1003호\",\"DeliveryName\":\"양경윤\",\"DeliveryPhoneNo1\":\"010\",\"DeliveryPhoneNo2\":\"4361\",\"DeliveryPhoneNo3\":\"5889\",\"IsSmilebox\":false,\"SmileboxBranchNo\":0.0}],\"complexPaymentList\":[],\"paymentMethodData\":{\"baseMethodCode\":\"200000036\",\"subMethodCode\":\"300000240\",\"certificationWay\":0.0,\"mobileCarrier\":0.0,\"isSavingDefaultPaymentMethod\":true},\"deviceData\":{\"BrowserType\":1.0,\"DeviceType\":2.0,\"OSType\":2.0,\"ViewType\":0.0,\"InfoString\":\"{\\\"OS\\\":{\\\"Family\\\":\\\"Android\\\",\\\"Major\\\":\\\"6\\\",\\\"Minor\\\":\\\"0\\\",\\\"Patch\\\":\\\"1\\\",\\\"PatchMinor\\\":null},\\\"Device\\\":{\\\"Family\\\":\\\"Samsung SM-G600S\\\",\\\"IsSpider\\\":false},\\\"UserAgent\\\":{\\\"Family\\\":\\\"Chrome Mobile\\\",\\\"Major\\\":\\\"44\\\",\\\"Minor\\\":\\\"0\\\",\\\"Patch\\\":\\\"2403\\\"}}\"},\"orderEtcData\":{\"CrossOrderPathType\":0.0,\"IsCashbackAvailable\":true},\"samsungCommerceData\":{\"partnershipBuyerNo\":6.23111778E8,\"representativeItemNo\":\"884043280\",\"representativeItemName\":\"여배우 은침귀걸이/패션반지/롱귀걸이/진주\",\"representativeImg\":\"https://sslgdimg1.gmarket.co.kr/goods_image2/large_jpgimg/884/043/884043280.jpg\",\"itemList\":[\"884043280\",\"884043280\",\"884043280\",\"884043280\"],\"totalPaymentAmount\":19600.0}},\"params\":{}}","domain": "GMKT","namespace": "NOT_SET","host": "NOVAFEMKR02GM","pcid": "","class": "NOT_SET","facility": "ESG.FE_M","http_header": "{\"host\":\"app\",\"connection\":\"close\",\"content-length\":\"3008\",\"accept\":\"application/json\",\"origin\":\"https://mescrow.gmarket.co.kr\",\"user-agent\":\"Mozilla/5.0 (Linux; Android 6.0.1; SAMSUNG SM-G600S Build/MMB29M) AppleWebKit/537.36 (KHTML, like Gecko) SamsungBrowser/4.0 Chrome/44.0.2403.133 Mobile Safari/537.36\",\"content-type\":\"application/json\",\"referer\":\"https://mescrow.gmarket.co.kr/ko/order?orderIdx\\u003d1113a2825%2c1113a2827%2c1113a2829%2c1113a282a\\u0026itemNo\\u003d884043280\",\"accept-encoding\":\"gzip, deflate\",\"accept-language\":\"ko-KR,ko;q\\u003d0.8,en-US;q\\u003d0.6,en;q\\u003d0.4\",\"client-ip\":\"223.38.8.194\"}","http_cookie": "{\"PCUID\":\"14898323338957378877490\",\"_ga\":\"GA1.3.1468687295.1490538888\",\"user%5Finfo\":\"CouponCnt\\u003d3\\u0026PackCnt\\u003d0\\u0026safe_login\\u003d5\\u0026isMember\\u003dMEM\\u0026isDonatee\\u003dN\\u0026isZeroMargin\\u003dN\\u0026isEmailValid\\u003dY\\u0026custType\\u003dPP\\u0026jaehuCustNo\\u003dTI0MR38zODE2MYx0MTE3MTcxODR/Rw\\u003d\\u003d\\u0026ageGroup\\u003dC\\u0026CR_Type\\u003dS\\u0026corpIdNo\\u003d\\u0026clusterID\\u003dS000\\u003d3201\\u0026toastYN\\u003dY\\u0026pif\\u003dGMKTyang4rang120425669010-4361-5889fNN00000000000000000000200003514양하윤susugeki@naver.com02-3437-6078134-787NNN10NNN201703301359\\u0026sif\\u003db8039805f3187d61baef4b8515bfacf4\\u0026isAdultUse\\u003dN\\u0026adultAuth\\u003d706B3F10F23D30EEA8608BA23D549EE58F16E2DD506C0C0E35D544DF080CDA1A\\u0026time\\u003d2017-03-30+13:59:55\\u0026sbgid\\u003d4F50D184E2C9576CDEB7D579630BA660\",\"mgpid\":\"F2FA4303370348BE79BC3A5F4D5FF3E0F5F0C93254886460B1F852D6D4375E7A21465BFF770034136822FFD418518612793EADDCE0E3875CDEE55F757211CD4ED30947FD79130DFD1A0FDE8014D64C9FA8D4BC55515334226D209AE32A94DF51\",\"landing\":\"banner\\u003d2017-03-29+%bf%c0%c8%c4+7%3a10%3a47\",\"charset\":\"enUS\",\"shipnation\":\"KR\",\"sguid\":\"31490846253161000862244000\",\"cguid\":\"11390233958442012762000000\",\"pguid\":\"21489832313011004632020000\",\"ordercomplete\":\"111386722\",\"BASKET%5FCALLBACK%5FSTAT\":\"F\",\"jaehuid\":\"200003514\",\"RPM\":\"BT\\u003dL1490849786814\",\"ssguid\":\"3149084964715900384224400012\",\"sp_smile_page\":\"3\",\"sp_shopIdDbCode\":\"S001\",\"sp_subShopId\":\"None\",\"sp_token\":\"eyJhbGciOiJBMjU2Q0JDIiwiZW5jIjoiQTI1NkNCQyJ9.~mqYkj21Pz6A8ZNUoGLT79csmPqFy9nVFv3kH1ZCyJJdRt14iAQhKFJVFSqJbGLaNW7HwdUOIAbakh5rnF89IST1yCMeP25e2GO8HozwwggOzOx+J7YoGt4UHd9ueGSNeecbZ8sPob+UUbFADs1BmHOCEjFxcH7F9nUgWT3//9it6bB1a6cO9gqcHP4vh7Te7zN8VVa9DA90DsYwyM+oYiUDc7rqKsdCrCZqH/5XwC03nAfrthgb256JTyrsOG1Cjscw8WhP6B2H4wqMueXUk1Va0FVyUn+WuTrEhtzdwruNJR173VAIOYZvguxu6U+Yb+iqkp9tIdMJgsXEqWhtyEgjfas08M0qZEMUOhMGZvfg\\u003d\",\"sp_page\":\"3\",\"sp_return_url\":\"https://mescrow.gmarket.co.kr/ko/order/gateway/newsmilepay/success\",\"sp_cancel_url\":\"https://mescrow.gmarket.co.kr/ko/order/gateway/newsmilepay/close\",\"ORDER%5FINFO\":\"PBID\\u003d4A32CDAC-B22A-4F74-BA01-49F104CE9AAE\"}","non_param_url": "","application_version": "1.1.0","timestamp": "2017-03-30T13:59:56.785+09:00"}
	//`)
	//
	//exampleString := parser.GmarketAddOrderParser(data)
	//fmt.Println(exampleString)

	stopChannel := make(chan bool)
	defer func() {
		close(stopChannel)
	}()
	out := gateway.StartGmarketNydusCanal(stopChannel, "localhost:9092")

	count := 0
	for str := range out {
		fmt.Println(str)
		count++
		if count > 10 {
			stopChannel <- true
		}
	}
}
